# 第四章 灰度空间与空间滤波

 Author： 中山大学 17数据科学与计算机学院 YSY

 https://github.com/ysyisyourbrother  

[TOC]

## 直方图处理

### 灰度直方图

图像中每种灰度级的像素个数。横坐标是灰度级，纵坐标是该灰度级出现频率

这里要注意纵坐标是频率还是次数

图片不同直方图又不同的感受：

![image-20200104222028726](assets/image-20200104222028726.png)



### 统计灰度直方图

<img src="assets/image-20200104222734312.png" alt="image-20200104222734312" style="zoom:67%;" />

### 应用

1. 判断图像是否合理利用了所有灰度级范围

2. 分割前景背景

   <img src="assets/image-20200104223112014.png" alt="image-20200104223112014" style="zoom:67%;" />

3. 计算面积

   <img src="assets/image-20200104224838206.png" alt="image-20200104224838206" style="zoom: 50%;" />

<img src="assets/image-20200104224946140.png" alt="image-20200104224946140" style="zoom:50%;" />

<img src="assets/image-20200104224950037.png" alt="image-20200104224950037" style="zoom:50%;" />



### 连续图像的直方图计算

连续的图像的灰度值计算比较麻烦，要用到积分的方法。

连续图像的灰度概率分布为：

- H(D)是连续图像的灰度概率直方图

  ![image-20200104232348150](assets/image-20200104232348150.png)

- A(D)是连续图像的具有灰度级D以上的阈值面积函数：

  ![image-20200104232354809](assets/image-20200104232354809.png)

![image-20200104232403315](assets/image-20200104232403315.png)

- 概率密度函数是归一化到单位面积的直方图H(D)：

  ![image-20200104232441522](assets/image-20200104232441522.png)

- 累计分布函数CDF是：对PDF进行积分的阈值面积函数：

  ![image-20200104232555363](assets/image-20200104232555363.png)

- H(D)积分得到A(D)；A(D)求导得到H(D)

  <img src="assets/image-20200104233139737.png" alt="image-20200104233139737" style="zoom:80%;" />

#### 例题：

<img src="assets/image-20200104233919030.png" alt="image-20200104233919030" style="zoom: 80%;" />

1. 计算灰度值为D的地方x为多少$D=e^{-x^2}$解出$X=\sqrt{-ln(D)}$，然后因为横坐标是对称的，所以大于灰度D的面积为2x

   <img src="assets/image-20200104234108686.png" alt="image-20200104234108686" style="zoom:67%;" />

2. 应用上面的公式计算直方图：

   <img src="assets/image-20200104234244490.png" alt="image-20200104234244490" style="zoom:67%;" />



### 直方图均衡化

#### 灰度变换函数

![image-20200105000357408](assets/image-20200105000357408.png)

![image-20200105000438356](assets/image-20200105000438356.png)

#### 原理推导

找到一个灰度变换函数T，满足单调递增，并且存在反函数

<img src="assets/image-20200105001012930.png" alt="image-20200105001012930" style="zoom:80%;" />

![image-20200105001021049](assets/image-20200105001021049.png)

面积相同因为原图像的像素点数量不能变。

这里的目标是从HA(D)经过灰度变换函数进行坐标映射后，生成HB(D)的值

![image-20200105001252010](assets/image-20200105001252010.png)

![image-20200105001458291](assets/image-20200105001458291.png)

![image-20200105002351783](assets/image-20200105002351783.png)



#### 直方图均衡化

下面的问题是如何找到一个灰度变换函数让直方图均匀分布

我们要让映射后的点DB均匀分布：

![image-20200105003013596](assets/image-20200105003013596.png)

因此可以推理出我们要的灰度变换函数为：

<img src="assets/image-20200105003504158.png" alt="image-20200105003504158" style="zoom:80%;" />

![image-20200105003650432](assets/image-20200105003650432.png)

#### 直方图均衡的缺点

 直方图使灰度级分布具有均匀概率密度，扩展了像素取值的动态范围但减少了灰度级 。因为它不能把同一个灰度级的像素映射到不同灰度级上，但有可能原图多个灰度级因为四舍五入进入了同一个灰度级。

如果原图中灰度级突然很大，就可能导致映射后的图中有一部分空缺，灰度为0。因为虽然是单值函数，但因为四舍五入的原因，可能会多个映射到一个。



### 直方图匹配

![image-20200105004724228](assets/image-20200105004724228.png)

![image-20200105004743398](assets/image-20200105004743398.png)

![image-20200105005845029](assets/image-20200105005845029.png)



## 算数/逻辑操作增强

![image-20200105010547694](assets/image-20200105010547694.png)

### 图像加法

#### 削弱随机噪声

![image-20200105010652473](assets/image-20200105010652473.png)



### 减法处理：

减法操作之后可以用minmax规范到0到255之间

<img src="assets/image-20200105010934383.png" alt="image-20200105010934383" style="zoom:80%;" />

#### 找出图片细微的差别

![image-20200105010716760](assets/image-20200105010716760.png)

#### 指纹抽取

![image-20200105010814676](assets/image-20200105010814676.png)



### 图像乘法和除法

使用比较少







## 空域滤波

### 空间滤波机理

滤波器响应是滤波器系数与由该滤波器包围的图像像素乘积之和

![image-20200105015808691](assets/image-20200105015808691.png)

可以表示为：

![image-20200105015929994](assets/image-20200105015929994.png)

![image-20200105015942982](assets/image-20200105015942982.png)

![image-20200105030458977](assets/image-20200105030458977.png)

### 相关和卷积

- 相关就是滤波器模版移过图像并计算每个位置乘积之和。

  ![image-20200105020913299](assets/image-20200105020913299.png)

- 卷积类似，但开始前滤波器要旋转180

  ![image-20200105020924800](assets/image-20200105020924800.png)

![image-20200105020135484](assets/image-20200105020135484.png)

一个函数和一个冲激的卷积得到原来函数

一个函数和一个冲激动相关得到180度旋转后的函数

在二维图像上为：

![image-20200105020446913](assets/image-20200105020446913.png)

#### 卷积padding

![image-20200105110052317](assets/image-20200105110052317.png)



### 相关和卷积应用

注意相关值计算图片之间的关联

卷积是一种滤波操作

#### 相关应用

检测图片上是否有该模版图像

![image-20200105105548780](assets/image-20200105105548780.png)

如下图找出图像中的车轮位置。但不能直接使用下面的公式

<img src="assets/image-20200105105705529.png" alt="image-20200105105705529" style="zoom:80%;" />

因为如果车轮匹配到一个各像素值都比较大的区域，也有可能输出较大的结果，因此我们需要进行归一化：

<img src="assets/image-20200105105733919.png" alt="image-20200105105733919" style="zoom: 80%;" />

用原图对应区域的像素平方和作为归一化的方法

![image-20200105110936406](assets/image-20200105110936406.png)



### 平滑空间滤波器

左边这个是均值滤波右边是高斯平滑滤波

blur 模糊不清

![image-20200105021026483](assets/image-20200105021026483.png)

二维的高斯滤波器为：

<img src="assets/image-20200105110511804.png" alt="image-20200105110511804" style="zoom:67%;" />

滤波器越大，模糊程度更大。当目标位置的灰度和相邻位置的灰度比较接近时，会导致目标模糊混合。可以将较小物体如噪音融合到背景中。

![image-20200105022151352](assets/image-20200105022151352.png)

### 统计排序滤波器

**统计排序滤波器**：将滤波器包围的图像区域中像素排序，并用排序结果决定的值代替中心像素的值。

**中值滤波器：**最知名的统计排序滤波器，用像素领域内灰度的中值代替该像素的值。中值滤波对一定类型的随机噪声效果很好，相比同尺寸平滑滤波模糊程度要低。尤其是**椒盐噪声**

**椒盐噪声：**也称脉冲噪声，是一种随机出现的白点或黑点，灰度值比较极端。如果用平滑滤波因为它灰度值过大或小可能效果不好。

![image-20200105022558613](assets/image-20200105022558613.png)



### 锐化空间滤波器

#### 基础

一阶微分如下：

![image-20200105022700816](assets/image-20200105022700816.png)

二阶微分如下：

![image-20200105022705812](assets/image-20200105022705812.png)

![image-20200105022920244](assets/image-20200105022920244.png)

1. 数字图像中的边缘在灰度上通常类似于斜坡过度，沿斜坡一阶微分非0
2. 对于台阶，二阶微分产生由0分开的一个像素宽的双边缘（在零交叉两侧，如果是斜坡也一样不过宽度更大）。二阶微分在增强细节上比一阶微分好得多，是一个适合锐化图像的理想特性。



#### 拉普拉斯算子

一个二维图像的拉普拉斯算子定义为：

![image-20200105023509503](assets/image-20200105023509503.png)

![image-20200105023536410](assets/image-20200105023536410.png)

拉普拉斯对原图像增强的基本方法为：

![image-20200105023645562](assets/image-20200105023645562.png)

![image-20200105023730263](assets/image-20200105023730263.png)

直接用拉普拉斯锐化可以进行边界的检测，拉普拉斯平滑可能有正有负，可以整体平移到灰度范围内（**标定**），也可以把负值当作0

![image-20200105024109160](assets/image-20200105024109160.png)



#### 非锐化掩蔽和高提升滤波

**非锐化掩蔽：**另外一种锐化的方法是，从原图中减去一副非锐化的（平滑过的）版本。

![image-20200105024501191](assets/image-20200105024501191.png)

<img src="assets/image-20200105024536505.png" alt="image-20200105024536505" style="zoom:67%;" />

首先我们得到模版：

![image-20200105024644226](assets/image-20200105024644226.png)

然后在原图像上加上该模版的一个权重：

![image-20200105024703053](assets/image-20200105024703053.png)

当k=1的时候是**非锐化掩蔽**

当k>1的时候是**高提升滤波**



### 使用一阶微分锐化

定义梯度

![image-20200105111417903](assets/image-20200105111417903.png)

可以用绝对值来计算：

![image-20200105111434283](assets/image-20200105111434283.png)

![image-20200105111446403](assets/image-20200105111446403.png)



#### 罗伯特交叉梯度算子

![image-20200105111519665](assets/image-20200105111519665.png)

可以使用交叉微分计算：

平方：

![image-20200105111540012](assets/image-20200105111540012.png)

或者绝对值：

![image-20200105111614257](assets/image-20200105111614257.png)

![image-20200105111821350](assets/image-20200105111821350.png)



#### Sobel算子

在z5为中心的3*3的模版中我们可以使用：

![image-20200105111715444](assets/image-20200105111715444.png)

中心系数为2是为了突出中心点的作用。

可以得到：

![image-20200105111756631](assets/image-20200105111756631.png)

![image-20200105111836266](assets/image-20200105111836266.png)