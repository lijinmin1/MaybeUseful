## 云计算概论课程 重要知识点

17341190	叶盛源	数据科学与计算机学院

#### 1. 云计算的定义是什么？

在本教材中对云计算的定义是分布式计算的一种特殊形式，它引入效用模型来远程供给可拓展和可测量的资源。它本质就是一种基于互联网的计算方式，通过这种方式，一些共享的软硬件资源和信息就可以提供给世界各地的终端设备，它们使用服务商提供的资源和信息进行计算。

NIST对云计算的定义，大概是目前为止最被广泛认同的定义：云计算是一种模型，实现无处不在的、方便、通过网络按需访问的可配置的共享计算资源池（例如，网络、服务器、存储、应用程序、服务），这些资源可以快速提供，通过最小化管理成本或与服务提供商进行交互。



#### 2. 云计算有哪些基本特性？有什么交付模型？有什么部署模型？

云计算包括以下这些基本特性：

- **按需使用：**用户想要使用的时候，可以在不用服务提供商人工干涉，可以自助的单边访问云资源。服务商需要具有资源动态分配与回收的能力。

- **随处访问：**用户只要有网络（无线或有线），用任何终端（手机、平板或PC），都可以去访问到服务商提供的资源。服务商的服务需要制定多种接口标准，支持多种传输协议，同时也要有多种安全的技术。

- **多租户：**同一个资源可以被多个用户共享。一台物理机器，可能通过docker或者虚拟化技术，将服务器的硬件资源（cpu，gpc，内存，硬盘等）分割同时为多个租户提供服务。服务商需要能够根据用户的需求，动态的分配IT资源，而且要做到租户之间的资源（性能）隔离，安全隔离（隐私、数据安全）。

- **弹性：**自动的、透明的提供IT资源的能力。资源能被弹性的配置和发布，可以自动的扩容或缩容等。

- 可测量的使用：云计算系统能够自动控制并优化资源的使用。需要监控用户的资源使用率，为服务提供商提供计费的数据，同时为使用者提供透明的服务使用情况，方便使用者获取服务器性能监控、安全和操作日志等信息。

- **可恢复性：**本质上是分布式系统的可靠性，容错性，是一种故障转移的形式。

  用户的存储数据分放到多地，冗余保存，这样在一份数据丢失之后可以进行恢复。

  在部署服务的时候，用户可以异地部署，多地同时提供服务，如果某一台虚拟机宕机，还有其他服务器提供支持。有Active-Active（同时提供服务）和Active-Standby（主备模式，一台提供服务，一台不提供，宕机后启用未提供服务的机器。

  虚拟机迁移技术，将虚拟机迁移到其他物理机器上，不影响服务的进行。



云交付模型包括以下：

- **基础设施作为服务(IaaS)：**云服务商提供给消费者的资源包括硬件、网络、操作系统及一些原始的IT环境。通俗的理解的就是买了一台全新的笔记本（裸机），只不过是和云服务商购买的没有实体的但是具有云特性的”笔记本电脑“。在IaaS中，IT资源通常是虚拟化的并打包成包提供给你使用。

  和买实体笔记本的区别在于，用户购买后可以自由伸缩调整资源，因为可恢复性也不会出现故障。你不用携带笔记本到处走，可以通过各种终端设备去直接访问它的硬件资源和设备。

- **平台作为服务(PaaS)：**预先定义好的“就绪可用”的环境，一般由已经部署好和配置好的IT资源组成。服务商已经帮你将环境配置好了，比如你要跑深度学习，选择一个预安装人工智能开发环境的服务，已经帮你装好了pytorch tensorflow的框架，你可以把代码放上去直接运行就行了。

  服务商提供给消费者的资源是可以使用由服务商支持的编程语言、库、服务和工具，把由消费者创建或购买的应用程序部署在云计算基础设施上，比如google提供的云服务GAE可以很方便的帮我们部署安卓的应用程序等。消费者并不管理或控制底层云计算基础设施，包括网络、服务器、操作系统、存储，但对部署的应用程序有控制权

- **软件作为服务(SaaS)**：提供给消费者的资源是运行在云计算基础架构上的服务商提供的应用程序。各种客户端通过瘦客户端接口访问该应用程序，例如Web浏览器，或程序接口。消费者并不管理或控制底层的云计算基础架构，包括网络、服务器、操作系统、存储、甚至应用程序本身的功能，只允许部分受限的用户设置特定的应用程序设置。

  比如你想开一个网店，使用淘宝提供的服务，就可以很快的得到一个网店的雏形，免去很多开发的负担。只需要上传图片文字，就可以把商品上架。



云部署模型包括以下：

- **公有云：**云计算基础架构提供给公众开放使用。比如阿里云，腾讯云，只要给钱就可以租用的。
- **社区云：**云计算基础架构提供给一个由多个组织的成员组成的消费者社区专门使用。小圈子里使用的
- **私有云：**云计算基础架构提供给包含多个消费者的单一组织专门使用。很多公司内部都是自己搭建使用私有云，比起放在公有云上更安全。
- **混合云：**由两个或多个独立的不同云计算基础架构（私有、社区或公有）组成。



#### 3. 改进型胖树网络结构和优缺点分析

改进型胖树网络架构由三层网络组成：

1. **核心交换机**：核心层是网络的主干部分，对网络请求进行高速的转发通信。
2. **汇聚交换机**：汇聚层用来连接核心层和接入层。一般是实现策略的地方。
3. **接入交换机**：网络中直接面向用户连接或访问网络的部分就是接入层。

连接方法如下：

1. 每台核心交换机有k个端口，每个端口与一个Pod相连，共k个Pod
2. 每个Pod有k/2个汇聚交换机和k/2个接入交换
3. 每个汇聚交换机有k/2个端口连接各个核心交换机，k/2个端口连接接入交换机
4. 每个接入交换机有k/2个端口连接同Pod的汇聚交换机，k/2个端口连接用户终端主机

优缺点分析：

1. 每台核心交换机与每个Pod相连。说明只要有一台核心交换机还正常，网络就不会断开。冗余度为$k/2\times k/2$

2. 同一Pod内，每个汇聚交换机与所有接入交换机连通。汇聚交换机和接入交换机是全相连的模式，不管哪一台汇聚交换机坏掉了，整个pod还是连通的。

   同一个pod内部的终端相互通信，流量就可以内部消化了，不需要跑到核心交换机上。

3. 扩展性：最大支持的服务器越多，扩展性就越好。

   最大的规模为$k\times(k/2)\times(k/2)$第一项是pods数量，第二项是每个pod里有多少个汇聚交换机，第三项是每个汇聚交换机有多少个接口连接核心交换机。这样算出来就可以得到核心交换机的接口数。也就是需要$(k/2)\times(k/2)$个核心交换机的数量。



#### 4. 基于操作系统的寄居虚拟化有什么特点？

它由四层组成，最底层是硬件（笔记本，主机），第二层是主机本身的操作系统（window，linux），第三层是虚拟机监控器VMM（常见的如VMware），最后一层就是用户的虚拟机。它有如下的特点：

1. 宿主操作系统负责管理硬件资源。因为VMM是安装到宿主的操作系统上，是一个操作系统上的一个应用程，因此得名操作系统的寄居虚拟化。
2. 在我们使用VMware的时候，比如在windows系统上安装一个linux操作系统，我们会需要给它分配硬件，网络等资源，而VMM就是用来模拟硬件的行为，让虚拟机的操作系统都以为自己是运行在物理机器上的。通过软件的行为模拟出一套硬件的资源环境提供给虚拟机调度。
3. 最顶层就是我们安装的虚拟机，比如linux操作系统，我们就在上面运行我们的应用程序。

它具有的优点是：

1. 实现简单，VMM是一个基于操作系统的普通应用程序，运行在客户机的操作系统上。

缺点是：

1. 宿主操作系统和VMM运行都会消耗系统的资源。
2. 客户机操作系统需要穿越多层，性能相对较低。



#### 5. CPU虚拟化有什么挑战？

一般的操作系统运行在基本的硬件上，内核需要直接访问硬件（比如内存，cpu等），运行在最高等级的Ring0。而一般的应用程序，它是用在最低的特权级别Ring3的，这是为了保护底层的硬件和系统的正常运行。用户程序的一般指令运行在Ring3级别上，不受到管控，也不会影响系统。但一些访问公共资源的操作，比如访问磁盘、发送网络请求这些，都需要向内核去请求系统调用，让内核用Ring0权限来执行。

这里存在的问题是，在基于宿主机的虚拟化中，虚拟机作为一个普通的应用程序应该是运行在Ring3上的，但是虚拟机操作系统的内核指令又需要运行在Ring0，因此这就存在了困难。因此我们需要VMM来完成一些额外的操作，虚拟机的操作系统还是运行在Ring3上，而需要运行Ring0权限的指令就交给VMM去完成。基本实现方法如下：

1. **特权解除**：解除虚拟机操作系统的Ring0特权
2. **特权指令陷入模拟**：执行特权指令时自动陷入VMM模拟执行
3. **临界指令虚拟化**：不会自动陷入VMM的指令需要虚拟化



#### 6. 简述影子页表基本原理

在物理机上，我们一般只有逻辑地址和物理地址两种。但是在虚拟机技术中，会运行多个虚拟的操作系统，此时内存就分为了分为虚拟机虚拟地址，虚拟机物理地址和物理地址。VMM负责维护客户机物理地址到宿主机物理地址之间的映射关系。这里存在的问题是两层内存地址转换需要大量时间开销，需要优化原来的TLB地址映射的性能。

在影子页表中，VMM为每个客户机操作系统维护一个影子页表，影子页表记录了客户机虚拟地址到宿主机物理地址的直接映射。它的建立过程如下：

1. 初始化时，客户机操作系统页表、VMM页表、影子页表均为空
2. 客户机操作系统建立GVA到GPA的映射后，CPU访问内存时会发生缺页异常
3. 缺页异常导致VMM建立GPA到MA的映射，并建立GVA到MA的直接映射，即影子页表

影子页表具有的优点是：

1. 影子页表可由TLB实施加速
2. 影子页表对客户机透明，无需修改OS
3. 建立影子页表的过程中地址转换比较慢



#### 7. 简述MMU半虚拟化基本原理

与影子页表VMM维护映射关系不同，MMU由客户机操作系统维护GVA到MA的直接映射，此时VMM和客户虚拟机共享同一个虚拟地址空间（对于多台虚拟机的情况，多台虚拟机都占用各自的地址空间（如0-3G），分别和VMM的地址空间拼接组成一个共享的内存空间（如3-4G））。它的建立过程大致如下：

1. 客户机OS创建新页表时通过“超级调用”向VMM注册页表
2. VMM剥夺客户机OS对该页表的写权限
3. 客户机OS对该页表的所有写操作陷入VMM加以验证和转换
4. VMM负责安全性和隔离性检查，并将客户机OS页表的GPA修改为MA

这个方法需要修改客户机的操作系统，使之具有页表注册和写权限下放功能。



#### 8. 虚拟机迁移的基本步骤是什么？

虚拟机迁移有六个主要步骤

1. **预迁移**：主机A打算迁移其上一个虚拟机VM，首先选择一个目的物理机B作为VM的新主机。此时就存在很多策略的问题，比如如何去选择负载比较低的新主机，或者是一台地理位置更合适的主机，需要一个算法去做出决定。
2. **预定资源**：主机A向主机B确认是否有必要的资源，如果B有这些资源可以提供，A就想B预定这些资源，否则就会返回第一步重新选择合适的物理主机。
3. **预复制**：在VM仍然运行的情况下，通过不断迭代将VM的内存页复制到主机B的虚拟机中。在第一轮的迭代中，所有的内存页都要复制到主机B的虚拟机中，后续的迭代步骤只需迁移修改过的页面，因为主机A是一直在运行的，因此A上的内存一直在更新，所以需要用迭代的方法让主机B去逐步接近主机A的内存数据。

4. **停机复制**：停止主机A上的VM，将它的网络连接重定向到B上的虚拟机。此时，CPU的状态和前一轮修改过的内存都要传输到B上的虚拟机。因为有了预复制，内存大部分数据都已经在虚拟机上了，此时停机复制速度相对就很快。
5. **提交**：主机B通知A已经收到映像，主机A向B确认该消息，并删除其上的VM。
6. **启动**：启用迁移到B上的VM，正式开始接受网络上的请求。



#### 9. 内存迁移的基本步骤是什么？

内存迁移是比较麻烦的工作，因为在虚拟机迁移的时候，虚拟机如果停机对原有程序或服务的运行存在很大的影响。但是不停机迁移，内存数据又会一直在改变。内存迁移一般可能包含以下三个步骤：

1. **Push阶段**：物理主机A上的VM在运行过程中通过多轮迭代将自己的内存页推送到B上的虚拟机中，每一轮推送在上轮之后修改过的内存页。每一轮时间间隔会越来越短，它们的内存数据会越来越接近。
2. **Stop-and-Copy阶段**，物理主机A上的VM停止工作，此时不接受请求，或者暂时阻塞进一个队列中，然后将剩下的修改过的内存页复制到B上的虚拟机，启动虚拟机。
3. **Pull阶段**：物理主机B上的虚拟机在运行过程中访问到未被拷贝的内存页，产生缺页中断，从物理主机A将缺失的内存页拷贝过来

一般步骤一和步骤二就可以基本完成内存的迁移过程。



#### 10. 简述TFS系统架构以及与GFS的不同

TFS由三大组件组成：

1. **NameServer**：两个元数据服务器，一主一备，这样可以防止主服务器宕机导致数据丢失。
2. **DataServer**：数据服务器，大量的数据服务器存储数据。
3. **client**：应用程序访问存储系统的接口。

TFS和GFS的主要区别在于：

1. TFS没有引入租约机制。这是因为淘宝文件系统读多写少，在淘宝使用的时候一般就是上架下架商品才会涉及写入，绝大多数客户端浏览淘宝商品并不会发生写入操作，而文件系统中只有写的时候才需要上锁，因此并不需要引入复杂的租约机制。这样设计更简单，而且NameServer负载不会特别高。
2. 在GFS中，客户端可能需要写入多个副本中。TFS中，客户端只向主副本写入数据，再由主副本将数据同步到其他副本，没有流水式的数据推送，这样设计的同步方式更简单。

